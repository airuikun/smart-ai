{"version":3,"file":"index.js","sources":["../../src/index.tsx"],"sourcesContent":["import React from 'react';\nimport Vue from 'vue';\nimport { mountRootParcel, ParcelConfig } from 'single-spa';\nimport singleSpaVue from 'single-spa-vue';\n\nconst __VUE_INTERNAL_INIT__ = Vue.prototype._init;\nVue.prototype._init = function(options: any) {\n  /**\n   * TODO: 留个口儿 用来以后支持加载整个Vue应用\n   */\n  __VUE_INTERNAL_INIT__.call(this, options);\n};\n\ninterface Self {\n  Vue: typeof Vue;\n  [ propName: string ]: any;\n}\n\ninterface IProps0 {\n  name?: string;\n  id?: string;\n  visible?: boolean;\n  extraProps?: { [propName: string]: any };\n  loadType?: 'xhr' | 'script';\n  instable_publicPathBeReplacedKey?: string;\n}\n\ninterface IProps1 extends IProps0 {\n  url: string;\n  component?: object;\n}\n\ninterface IProps2 extends IProps0 {\n  component: object;\n  url?: string; \n}\n\ntype IProps = IProps1 | IProps2;\n\ninterface ISelecotr {\n  'getElementById': NonElementParentNode;\n  'querySelector': ParentNode;\n  'querySelectorAll': ParentNode;\n}\n\nexport default class VueIframe extends React.PureComponent<IProps, any> {\n  private loadType: IProps['loadType']; // 加载方式 支持ajax和script标签\n  private currentName: string; // 每个iframe的name\n  private visible: boolean; // 是否显示\n  private currentUrl: string; // 传进来的url\n  private currentPublicPath: string; // 传进来的url的协议+域名+端口\n  private publicPathKey: string; // 远程源代码中要被替换的关键字\n  private publicPathReg: RegExp; // 用来替换源代码中关键字的正则\n  private rootNodeWrapper = React.createRef<HTMLDivElement>(); // vue挂载节点是根据el再往上找它的爹\n  private component: any; // vue 组件实例\n  private parcel: any; // parcel实例\n  private vueWrapper1: HTMLDivElement = document.createElement('div'); // 挂载vue以及隐藏vue需要两个节点\n  private vueWrapper2: HTMLDivElement = document.createElement('div'); // 真正vue需要挂载的节点\n  private styleElements: HTMLLinkElement[] | HTMLStyleElement[] = [];\n\n  constructor(props: IProps) {\n    super(props);\n    const { loadType, url, component, name, visible, instable_publicPathBeReplacedKey } = props;\n    this.loadType = loadType || 'script';\n    // 初始化时候是否显示\n    this.visible = typeof visible === 'boolean' ? visible : true;\n    // 获取到外部传进来的vue组件\n    this.component = component;\n    // 获取到外部传来的url\n    this.currentUrl = url || '';\n    // 这个属性是用来标识要替换远程源代码中的publicPath的关键字\n    this.publicPathKey = instable_publicPathBeReplacedKey || '__WILL_BE_REPLACED_PUBLIC_PATH__';\n    // 这个正则会用来把远程源码中的__webpack_require__.p = 'xxxxx' 的xxxxx这个publiPath给替换掉\n    this.publicPathReg = new RegExp(this.publicPathKey, 'g');\n    // 生成每个iframe的唯一表示\n    this.currentName = name || '';\n    // 获取传进来的url的协议+域名+端口\n    this.currentPublicPath = `${(\n      new RegExp(\"^https?://[\\\\w-.]+(:\\\\d+)?\", 'i').exec(this.currentUrl) || ['']\n    )[0]}/`;\n    // vue会挂载到这个节点2上\n    this.vueWrapper2.id = this.currentName;\n    // 节点1是为了可以让vue随时visibility 同时使vue的根节点脱离react的fiber树\n    // this.vueWrapper1.appendChild(this.vueWrapper2);\n    // 临时保存appendChild\n    this.initHack();\n    // const originAppendChild = HTMLHeadElement.prototype.appendChild;\n    // const originSelector = HTMLDocument.prototype;\n    // const selectorMap = {\n    //   'getElementById': this.internalHackSelector('getElementById', originSelector['getElementById']),\n    //   'querySelector': this.internalHackSelector('querySelector', originSelector['querySelector']),\n    //   'querySelectorAll': this.internalHackSelector('querySelectorAll', originSelector['querySelectorAll']),\n    // };\n    // (this.internalHackCSSsandbox as Function) =\n    //   this.internalHackCSSsandbox.bind(this, originAppendChild);\n    // (this.internalHackJSSelector as Function) =\n    //   this.internalHackJSSelector.bind(this, originSelector, selectorList);\n    // selectorList.forEach(selectorName => {\n      \n    // });\n    // (elementId: string): HTMLElement | null\n    // const originGetElementById = originSelector['getElementById'];\n    // const _this = this;\n    // HTMLDocument.prototype.getElementById = function (id: string): HTMLElement | null {\n    //   console.log('88888 进来了了饿了来了')\n    //   const el = originGetElementById.call(this, id) ||\n    //     (_this.vueWrapper1.shadowRoot?.getElementById(id) as HTMLElement | null);\n    //   return el;\n    // }\n  }\n\n  private initHack = () => {\n    const originAppendChild = HTMLHeadElement.prototype.appendChild;\n    const s = HTMLDocument.prototype;\n    const selectorMap = {\n      'getElementById': this.initHackSelector('getElementById', s['getElementById']),\n      'querySelector': this.initHackSelector('querySelector', s['querySelector']),\n      'querySelectorAll': this.initHackSelector('querySelectorAll', s['querySelectorAll']),\n    };\n    (this.internalHackCSSsandbox as Function) =\n      this.internalHackCSSsandbox.bind(this, originAppendChild);\n    (this.internalHackSelector as Function) =\n      this.internalHackSelector.bind(this, selectorMap);\n  }\n\n  private internalHackSelector = (\n    selectorMap: { [name: string]: Function },\n    name: keyof ISelecotr,\n    codeIsExecuting: boolean,\n  ) => {\n    selectorMap[name](codeIsExecuting);\n  }\n\n  componentDidMount = async () => {\n    if (!this.currentUrl && !this.component) throw Error('组件必须接收一个url或者component属性');\n    const rootEleWrapper = this.rootNodeWrapper.current;\n    if (!rootEleWrapper) throw Error('没有vue组件的root节点');\n    const component = this.props.component || await this.getOriginVueComponent();\n    if (!this.isVueComponent(component)) return;\n    const lifecycles = this.registerVueComponent(this.vueWrapper2, component, this.currentName);\n    this.parcel = mountRootParcel((lifecycles as ParcelConfig), { domElement: '-' });\n    if (!this.visible) this.vueWrapper1.style.display = 'none';\n    const supportShadowDOM = !!rootEleWrapper.attachShadow;\n\n    this.vueWrapper1.attachShadow({ mode: 'open' });\n    this.vueWrapper1?.shadowRoot?.appendChild(this.vueWrapper2);\n\n    // if (supportShadowDOM) {\n    //   setTimeout(() => {\n    //     rootEleWrapper.attachShadow({ mode: 'open' });\n    //     rootEleWrapper.shadowRoot?.appendChild(this.vueWrapper1);\n    //   });\n    // } else {\n    //   rootEleWrapper.appendChild(this.vueWrapper1);\n    // }\n    rootEleWrapper.appendChild(this.vueWrapper1);\n    setTimeout(() => {\n      /**\n       * 对于一上来visible就是不可见的组件\n       * 先把display置为none 然后再添加进页面\n       * 这是为了防止vue组件中可能会有类似echarts\n       * 之类的工具会通过document.querySelector等\n       * 方法选择dom\n       * 如果直接就不把vue组件添加进页面的话\n       * vue组件内部那些选择dom的方法可能会产生问题\n       */\n      if (!this.visible) {\n        // if (supportShadowDOM) {\n        //   this.vueWrapper1 = rootEleWrapper?.\n        //     shadowRoot?.removeChild(this.vueWrapper1) as HTMLDivElement;\n        // } else {\n          this.vueWrapper1 = rootEleWrapper?.removeChild(this.vueWrapper1) as HTMLDivElement;\n        // }\n      }\n      this.vueWrapper1.style.display = 'block';\n    });\n  }\n\n  componentDidUpdate = () => {\n    const { visible = true } = this.props; \n    if (visible === this.visible) return;\n    this.visible = visible;\n    const rootNodeWrapper = this.rootNodeWrapper.current;\n    if (!visible) {\n      this.vueWrapper1 = rootNodeWrapper?.removeChild(this.vueWrapper1) as HTMLDivElement;\n    } else {\n      rootNodeWrapper?.appendChild(this.vueWrapper1);\n    }\n  }\n\n  /**\n   * componentWillUnmount被调用时候不一定就是出错\n   * 但是贸然地在react项目中挂载vue组件可能出现问题\n   * 当出现问题的时候react组件会被卸载 此时会调用componentWillUnmount\n   * 这个时候应该确认下项目是否还正常运行(八成报错)\n   */\n  componentWillUnmount = () => {\n    (this.rootNodeWrapper.current as any).removeChild(this.vueWrapper1);\n    (this.vueWrapper1 as any) = null;\n    (this.vueWrapper2 as any) = null;\n    this.parcel.unmount();\n  }\n\n  private initHackSelector = (\n    name: keyof ISelecotr,\n    originSelectorFn: ((id: string) => HTMLElement | null) |\n      (<E extends Element = Element>(id: string) => NodeListOf<E>),\n  ) => {\n    return (codeIsExecuting: boolean) => {\n      const HTMLDocumentPrototype = (HTMLDocument.prototype as any);\n      if (!codeIsExecuting) HTMLDocumentPrototype[name] = originSelectorFn;\n      const _this = this;\n      HTMLDocumentPrototype[name] = function <E extends Element = Element>(id: string):\n        HTMLElement | null | NodeListOf<E> {\n        return (originSelectorFn as any).call(this, id) || (\n          _this.vueWrapper1.shadowRoot &&\n          _this.vueWrapper1.shadowRoot[name] &&\n          (_this.vueWrapper1.shadowRoot as any)[name](id) as HTMLElement | null | NodeListOf<E>\n        );\n      }\n    }\n  }\n\n  private internalHackCSSsandbox = (\n    originAppendChild: <T extends Node>(this: any, newChild: T) => T,\n    codeIsExecuting: boolean,\n  ) => {\n    /**\n     * css 沙箱基于shadow dom\n     * 如果浏览器版本不支持shadow dom 那就不玩了\n     */\n    if (!this.rootNodeWrapper.current?.attachShadow) return;\n    if (!codeIsExecuting) HTMLHeadElement.prototype.appendChild = originAppendChild;\n    const LINK_TAG_NAME = 'LINK';\n    const STYLE_TAG_NAME = 'STYLE';\n    const _this = this;\n    HTMLHeadElement.prototype.appendChild = function <T extends Node>(this: any, newChild: T) {\n      const element = newChild as any;\n      if (element.tagName) {\n        switch (element.tagName) {\n          case LINK_TAG_NAME:\n          case STYLE_TAG_NAME: {\n            _this.styleElements.push(element);\n            return originAppendChild.call(this, element.cloneNode()) as T;\n          }\n        }\n      }\n      return originAppendChild.call(this, element) as T;\n    };\n\n  }\n\n  private internalHackJSSelector = (\n    originAppendChild: object,\n    selectorList: string[],\n    codeIsExecuting: boolean,\n  ) => {\n    selectorList.forEach(selectorName => {\n\n    });\n  }\n\n  private registerVueComponent = (el: string | HTMLElement, vueComponent: object, id: string) => {\n    const vueInstance = singleSpaVue({\n      Vue,\n      appOptions: {\n        el: typeof el === 'string' ? `#${el}` : el,\n        render: (h: any) => h('div', { attrs: { id } }, [h(vueComponent, {\n          props: { ...this.props.extraProps },\n        })]),\n      },\n    });\n    return ({\n      bootstrap: vueInstance.bootstrap,\n      mount: vueInstance.mount,\n      unmount: vueInstance.unmount,\n    })\n  }\n\n  private isVueComponent = (component: any): boolean => {\n    return component && typeof component === 'object' && typeof component.render === 'function';\n  }\n\n  private getOriginCode = (url: string, method: string = 'GET', data?: any): Promise<any> => {\n    return new Promise((res, rej) => {\n      const xhr: XMLHttpRequest = XMLHttpRequest ? new XMLHttpRequest() :\n        ActiveXObject ? new ActiveXObject('Microsoft.XMLHTTP') : null;\n      if (method === 'GET' && data) data && (url += `?${data}`);\n      xhr.open(method, url, true);\n      if (method == 'GET') {\n        xhr.send();\n      } else {\n        xhr.setRequestHeader('content-type', 'text/plain');\n        xhr.send((data as (Document | BodyInit | null)));\n      }\n      xhr.onreadystatechange = () => {\n        if (xhr.readyState === 4) {\n          if (xhr.status === 200) res(xhr.responseText);\n          else rej(xhr);\n        }      \n      }\n    });\n  }\n\n  private getCurrentName = (self: any): string => {\n    for (const props in self) {\n      if (!self.hasOwnProperty(props)) break;\n      if (props !== 'Vue') return props;\n    }\n    return '';\n  }\n\n  private executeOriginCode = (code: string): Self => {\n    const internalSelf: Self = { Vue };\n    const reg = this.publicPathReg;\n    const publicPath = this.currentPublicPath;\n    const url = this.currentUrl;\n    if (reg.test(code)) {\n      /**\n       * 自己开发组件的时候使用可以配置publicPath\n       * 为了让react-vue-mirco-frame支持加载静态资源\n       * 可以给publicPath设置为一个约定好的值\n       * 然后这里用传进来的origin替换掉这个约定好的值\n       * 这个约定好的值默认是 __WILL_BE_REPLACED_PUBLIC_PATH__\n       */\n      const codeStr = code.replace(reg, publicPath);\n      const originCodeFn = new Function(\"self\", codeStr);\n      originCodeFn(internalSelf);\n    } else {\n      /**\n       * 如果没有配置这个值的话 就以hack的方式注入origin\n       * webpack打包出来的umd代码里面会动态监测document.currentScript\n       * 通过临时给这个currentScript换掉的方式让webpack将origin注入进代码\n       */\n      const temporaryDocument = (window.document as any);\n      const originCurrentScript = window.document.currentScript;\n      const temporaryScript = document.createElement('script');\n      const defineProperty = Object.defineProperty;\n      temporaryScript.src = url;\n      defineProperty(temporaryDocument, 'currentScript', {\n        value: temporaryScript,\n        writable: true,\n      });\n      const originCodeFn = new Function(\"self\", code);\n      originCodeFn(internalSelf);\n      defineProperty(temporaryDocument, 'currentScript', {\n        value: originCurrentScript,\n        writable: false,\n      });\n      temporaryScript.remove && temporaryScript.remove();\n    };\n    return internalSelf;\n  } \n\n  private getOriginVueComponent = (): object => {\n    if (this.loadType === 'script') {\n      return new Promise(res => {\n        /**\n         * script标签没有defer或async的时候\n         * 下载数据以及执行都是同步的\n         */\n        (this.internalHackCSSsandbox as Function)(true);\n        (this.internalHackSelector as Function)('getElementById', true);\n        (this.internalHackSelector as Function)('querySelector', true);\n        (this.internalHackSelector as Function)('querySelectorAll', true);\n        const type = 'text/javascript';\n        const oScript1 = document.createElement('script');\n        oScript1.type = type;\n        const originSelf = window.self;\n        oScript1.innerText = 'window.self = {Vue: null}';\n        document.body.appendChild(oScript1);\n        window.self.Vue = Vue;\n        const oScript2 = document.createElement('script');\n        oScript2.type = type;\n        oScript2.src = this.currentUrl;\n        document.body.appendChild(oScript2);\n        oScript2.onload = () => {\n          (this.internalHackCSSsandbox as Function)(false);\n          (this.internalHackSelector as Function)('getElementById', false);\n          (this.internalHackSelector as Function)('querySelector', false);\n          (this.internalHackSelector as Function)('querySelectorAll', false);\n          const currentSelf: any = window.self;\n          (window as any).self = originSelf;\n          if (!this.currentName) (this.currentName = this.getCurrentName(currentSelf));\n          if (!this.currentName) throw Error('没有获取到vue组件, 造成问题的原因可能是远程组件并未遵循umd规范');\n          this.vueWrapper2.id = this.currentName;\n          this.component = currentSelf[this.currentName];\n          oScript1.parentNode?.removeChild(oScript1);\n          oScript2.parentNode?.removeChild(oScript2);\n          res(this.component);\n        };\n      });\n    } else {\n      return new Promise(res => {\n        this.getOriginCode(this.currentUrl).then(data => {\n          /**\n           * 通过XMLHttpRequest获取源代码\n           */\n          if (!data || typeof data !== 'string') throw Error('没有加载到远程vue组件');\n          (this.internalHackCSSsandbox as Function)(true);\n          (this.internalHackSelector as Function)('getElementById', true);\n          (this.internalHackSelector as Function)('querySelector', true);\n          (this.internalHackSelector as Function)('querySelectorAll', true);\n          const internalSelf = this.executeOriginCode(data);\n          (this.internalHackCSSsandbox as Function)(false);\n          (this.internalHackSelector as Function)('getElementById', true);\n          (this.internalHackSelector as Function)('querySelector', true);\n          (this.internalHackSelector as Function)('querySelectorAll', true);\n          if (!this.currentName) (this.currentName = this.getCurrentName(internalSelf));\n          if (!this.currentName) throw Error('没有获取到vue组件, 造成问题的原因可能是远程组件并未遵循umd规范');\n          this.vueWrapper2.id = this.currentName;\n          this.component = internalSelf[this.currentName];\n          res(this.component);\n        }).catch(err => {\n          /**\n           * 如果进入到这里说明可能请求出错了\n           */\n          console.warn('远程vue组件请求可能出现跨域或其他网络问题');\n          /**\n           * 如果出现跨域问题就强制使用script方式加载一遍\n           */\n          this.loadType = 'script';\n          res(this.getOriginVueComponent());\n        })\n      })\n    } \n  }\n\n  render = () => (<div id={this.props.id || ''} ref={this.rootNodeWrapper} />)\n}\n"],"names":["__VUE_INTERNAL_INIT__","Vue","prototype","_init","options","call","__extends","props","_super","_this_1","React","createRef","document","createElement","originAppendChild","HTMLHeadElement","appendChild","s","HTMLDocument","selectorMap","initHackSelector","internalHackCSSsandbox","bind","internalHackSelector","name","codeIsExecuting","currentUrl","component","Error","rootEleWrapper","rootNodeWrapper","current","_a","getOriginVueComponent","_d","isVueComponent","lifecycles","registerVueComponent","vueWrapper2","currentName","parcel","mountRootParcel","domElement","visible","vueWrapper1","style","display","supportShadowDOM","attachShadow","mode","shadowRoot","setTimeout","removeChild","_c","unmount","originSelectorFn","HTMLDocumentPrototype","_this","id","LINK_TAG_NAME","STYLE_TAG_NAME","newChild","element","tagName","styleElements","push","cloneNode","selectorList","forEach","selectorName","el","vueComponent","vueInstance","singleSpaVue","appOptions","render","h","attrs","extraProps","bootstrap","mount","url","method","data","Promise","res","rej","xhr","XMLHttpRequest","ActiveXObject","open","send","setRequestHeader","onreadystatechange","readyState","status","responseText","self","hasOwnProperty","code","internalSelf","reg","publicPathReg","publicPath","currentPublicPath","test","codeStr","replace","originCodeFn","Function","temporaryDocument","window","originCurrentScript","currentScript","temporaryScript","defineProperty","Object","src","value","writable","remove","loadType","type","oScript1","originSelf","innerText","body","oScript2","onload","currentSelf","getCurrentName","parentNode","getOriginCode","then","executeOriginCode","catch","err","console","warn","ref","instable_publicPathBeReplacedKey","publicPathKey","RegExp","exec","initHack","PureComponent"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAKA,IAAMA,qBAAqB,GAAGC,GAAG,CAACC,SAAJ,CAAcC,KAA5C;;AACAF,GAAG,CAACC,SAAJ,CAAcC,KAAd,GAAsB,UAASC,OAAT;;;;EAIpBJ,qBAAqB,CAACK,IAAtB,CAA2B,IAA3B,EAAiCD,OAAjC;CAJF;;AAuCA;;;EAAuCE,4BAAA;;oBAerC,CAAYC,KAAZ;kBACEC,WAAA,KAAA,EAAMD,KAAN,SADF;;IAPQE,uBAAA,GAAkBC,KAAK,CAACC,SAAN,EAAlB;;IAGAF,mBAAA,GAA8BG,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAA9B;;IACAJ,mBAAA,GAA8BG,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAA9B;;IACAJ,qBAAA,GAAwD,EAAxD;;IAqDAA,gBAAA,GAAW;UACXK,iBAAiB,GAAGC,eAAe,CAACb,SAAhB,CAA0Bc,WAApD;UACMC,CAAC,GAAGC,YAAY,CAAChB,SAAvB;UACMiB,WAAW,GAAG;0BACAV,OAAI,CAACW,gBAAL,CAAsB,gBAAtB,EAAwCH,CAAC,CAAC,gBAAD,CAAzC,CADA;yBAEDR,OAAI,CAACW,gBAAL,CAAsB,eAAtB,EAAuCH,CAAC,CAAC,eAAD,CAAxC,CAFC;4BAGER,OAAI,CAACW,gBAAL,CAAsB,kBAAtB,EAA0CH,CAAC,CAAC,kBAAD,CAA3C;OAHtB;MAKCR,OAAI,CAACY,sBAAL,GACCZ,OAAI,CAACY,sBAAL,CAA4BC,IAA5B,CAAiCb,OAAjC,EAAuCK,iBAAvC,CADD;MAEAL,OAAI,CAACc,oBAAL,GACCd,OAAI,CAACc,oBAAL,CAA0BD,IAA1B,CAA+Bb,OAA/B,EAAqCU,WAArC,CADD;KAVK;;IAcAV,4BAAA,GAAuB,UAC7BU,WAD6B,EAE7BK,IAF6B,EAG7BC,eAH6B;MAK7BN,WAAW,CAACK,IAAD,CAAX,CAAkBC,eAAlB;KALM;;IAQRhB,yBAAA,GAAoB;;;;;;;;;;;kBACd,CAAC,KAAKiB,UAAN,IAAoB,CAAC,KAAKC,SAA9B,EAAyC,MAAMC,KAAK,CAAC,0BAAD,CAAX;cACnCC,cAAc,GAAG,KAAKC,eAAL,CAAqBC,OAAtC;kBACF,CAACF,cAAL,EAAqB,MAAMD,KAAK,CAAC,gBAAD,CAAX;cACHI,KAAA,KAAKzB,KAAL,CAAWoB,SAAX;sBAAA;;kBAAA;;;gBAA8B,KAAKM,qBAAL,GAAN;;;mBAAAC,OAAA;;;;cAApCP,SAAS,KAAT;kBACF,CAAC,KAAKQ,cAAL,CAAoBR,SAApB,CAAL,EAAqC;;eAAA;cAC/BS,UAAU,GAAG,KAAKC,oBAAL,CAA0B,KAAKC,WAA/B,EAA4CX,SAA5C,EAAuD,KAAKY,WAA5D,CAAb;mBACDC,MAAL,GAAcC,eAAe,CAAEL,UAAF,EAA+B;gBAAEM,UAAU,EAAE;eAA7C,CAA7B;kBACI,CAAC,KAAKC,OAAV,EAAmB,KAAKC,WAAL,CAAiBC,KAAjB,CAAuBC,OAAvB,GAAiC,MAAjC;cACbC,gBAAgB,GAAG,CAAC,CAAClB,cAAc,CAACmB,YAApC;mBAEDJ,WAAL,CAAiBI,YAAjB,CAA8B;gBAAEC,IAAI,EAAE;eAAtC;0BACA,KAAKL,qDAAaM,UAAlB,UAAA,iBAAA,SAAA,MAA8BlC,YAAY,KAAKsB,YAA/C;;;;;;;;;cAUAT,cAAc,CAACb,WAAf,CAA2B,KAAK4B,WAAhC;cACAO,UAAU,CAAC;;;;;;;;;;;;;oBAUL,CAAC1C,OAAI,CAACkC,OAAV,EAAmB;;;;;kBAKflC,OAAI,CAACmC,WAAL,GAAmB,MAAAf,cAAA,UAAA,iBAAA,SAAA,MAAgBuB,YAAY3C,OAAI,CAACmC,YAApD,CALe;;;gBAQnBnC,OAAI,CAACmC,WAAL,CAAiBC,KAAjB,CAAuBC,OAAvB,GAAiC,OAAjC;eAlBQ,CAAV;;;;;;;KAvBF;;IA6CArC,0BAAA,GAAqB;;;UACX4C,0BAAA;UAAAV,mCAAA;UACJA,OAAO,KAAKlC,OAAI,CAACkC,OAArB,EAA8B;MAC9BlC,OAAI,CAACkC,OAAL,GAAeA,OAAf;UACMb,eAAe,GAAGrB,OAAI,CAACqB,eAAL,CAAqBC,OAA7C;;UACI,CAACY,OAAL,EAAc;QACZlC,OAAI,CAACmC,WAAL,GAAmB,MAAAd,eAAA,UAAA,iBAAA,SAAA,MAAiBsB,YAAY3C,OAAI,CAACmC,YAArD;OADF,MAEO;cACLd,eAAA,UAAA,iBAAA,SAAA,MAAiBd,YAAYP,OAAI,CAACmC,YAAlC;;KARJ;;;;;;;;;IAkBAnC,4BAAA,GAAuB;MACpBA,OAAI,CAACqB,eAAL,CAAqBC,OAArB,CAAqCqB,WAArC,CAAiD3C,OAAI,CAACmC,WAAtD;;MACAnC,OAAI,CAACmC,WAAL,GAA2B,IAA3B;MACAnC,OAAI,CAAC6B,WAAL,GAA2B,IAA3B;;MACD7B,OAAI,CAAC+B,MAAL,CAAYc,OAAZ;KAJF;;IAOQ7C,wBAAA,GAAmB,UACzBe,IADyB,EAEzB+B,gBAFyB;aAKlB,UAAC9B,eAAD;YACC+B,qBAAqB,GAAItC,YAAY,CAAChB,SAA5C;YACI,CAACuB,eAAL,EAAsB+B,qBAAqB,CAAChC,IAAD,CAArB,GAA8B+B,gBAA9B;YAChBE,KAAK,GAAGhD,OAAd;;QACA+C,qBAAqB,CAAChC,IAAD,CAArB,GAA8B,UAAuCkC,EAAvC;iBAEpBH,gBAAwB,CAAClD,IAAzB,CAA8B,IAA9B,EAAoCqD,EAApC,KACND,KAAK,CAACb,WAAN,CAAkBM,UAAlB,IACAO,KAAK,CAACb,WAAN,CAAkBM,UAAlB,CAA6B1B,IAA7B,CADA,IAECiC,KAAK,CAACb,WAAN,CAAkBM,UAAlB,CAAqC1B,IAArC,EAA2CkC,EAA3C,CAHH;SAFF;OAJF;KALM;;IAoBAjD,8BAAA,GAAyB,UAC/BK,iBAD+B,EAE/BW,eAF+B;;;;;;;;UAQ3B,QAAChB,OAAI,CAACqB,eAAL,CAAqBC,iDAASiB,YAA/B,CAAJ,EAAiD;UAC7C,CAACvB,eAAL,EAAsBV,eAAe,CAACb,SAAhB,CAA0Bc,WAA1B,GAAwCF,iBAAxC;UAChB6C,aAAa,GAAG,MAAtB;UACMC,cAAc,GAAG,OAAvB;UACMH,KAAK,GAAGhD,OAAd;;MACAM,eAAe,CAACb,SAAhB,CAA0Bc,WAA1B,GAAwC,UAAqC6C,QAArC;YAChCC,OAAO,GAAGD,QAAhB;;YACIC,OAAO,CAACC,OAAZ,EAAqB;kBACXD,OAAO,CAACC,OAAhB;iBACOJ,aAAL;iBACKC,cAAL;;gBACEH,KAAK,CAACO,aAAN,CAAoBC,IAApB,CAAyBH,OAAzB;;uBACOhD,iBAAiB,CAACT,IAAlB,CAAuB,IAAvB,EAA6ByD,OAAO,CAACI,SAAR,EAA7B,CAAP;;;;;eAICpD,iBAAiB,CAACT,IAAlB,CAAuB,IAAvB,EAA6ByD,OAA7B,CAAP;OAXF;KAbM;;IA6BArD,8BAAA,GAAyB,UAC/BK,iBAD+B,EAE/BqD,YAF+B,EAG/B1C,eAH+B;MAK/B0C,YAAY,CAACC,OAAb,CAAqB,UAAAC,YAAA,IAArB;KALM;;IAUA5D,4BAAA,GAAuB,UAAC6D,EAAD,EAA2BC,YAA3B,EAAiDb,EAAjD;UACvBc,WAAW,GAAGC,YAAY,CAAC;QAC/BxE,GAAG,KAD4B;QAE/ByE,UAAU,EAAE;UACVJ,EAAE,EAAE,OAAOA,EAAP,KAAc,QAAd,GAAyB,MAAIA,EAA7B,GAAoCA,EAD9B;UAEVK,MAAM,EAAE,gBAACC,CAAD;mBAAYA,CAAC,CAAC,KAAD,EAAQ;cAAEC,KAAK,EAAE;gBAAEnB,EAAE;;aAArB,EAA2B,CAACkB,CAAC,CAACL,YAAD,EAAe;cAC/DhE,KAAK,eAAOE,OAAI,CAACF,KAAL,CAAWuE;aADyB,CAAF,CAA3B,CAAD;;;OAJQ,CAAhC;aASQ;QACNC,SAAS,EAAEP,WAAW,CAACO,SADjB;QAENC,KAAK,EAAER,WAAW,CAACQ,KAFb;QAGN1B,OAAO,EAAEkB,WAAW,CAAClB;OAHvB;KAVM;;IAiBA7C,sBAAA,GAAiB,UAACkB,SAAD;aAChBA,SAAS,IAAI,QAAOA,SAAP,MAAqB,QAAlC,IAA8C,OAAOA,SAAS,CAACgD,MAAjB,KAA4B,UAAjF;KADM;;IAIAlE,qBAAA,GAAgB,UAACwE,GAAD,EAAcC,MAAd,EAAsCC,IAAtC;2BAAc,EAAA;QAAAD,cAAA;;;aAC7B,IAAIE,OAAJ,CAAY,UAACC,GAAD,EAAMC,GAAN;YACXC,GAAG,GAAmBC,cAAc,GAAG,IAAIA,cAAJ,EAAH,GACxCC,aAAa,GAAG,IAAIA,aAAJ,CAAkB,mBAAlB,CAAH,GAA4C,IAD3D;YAEIP,MAAM,KAAK,KAAX,IAAoBC,IAAxB,EAA8BA,IAAI,KAAKF,GAAG,IAAI,MAAIE,IAAhB,CAAJ;QAC9BI,GAAG,CAACG,IAAJ,CAASR,MAAT,EAAiBD,GAAjB,EAAsB,IAAtB;;YACIC,MAAM,IAAI,KAAd,EAAqB;UACnBK,GAAG,CAACI,IAAJ;SADF,MAEO;UACLJ,GAAG,CAACK,gBAAJ,CAAqB,cAArB,EAAqC,YAArC;UACAL,GAAG,CAACI,IAAJ,CAAUR,IAAV;;;QAEFI,GAAG,CAACM,kBAAJ,GAAyB;cACnBN,GAAG,CAACO,UAAJ,KAAmB,CAAvB,EAA0B;gBACpBP,GAAG,CAACQ,MAAJ,KAAe,GAAnB,EAAwBV,GAAG,CAACE,GAAG,CAACS,YAAL,CAAH,CAAxB,KACKV,GAAG,CAACC,GAAD,CAAH;;SAHT;OAXK,CAAP;KADM;;IAqBA9E,sBAAA,GAAiB,UAACwF,IAAD;WAClB,IAAM1F,KAAX,IAAoB0F,IAApB,EAA0B;YACpB,CAACA,IAAI,CAACC,cAAL,CAAoB3F,KAApB,CAAL,EAAiC;YAC7BA,KAAK,KAAK,KAAd,EAAqB,OAAOA,KAAP;;;aAEhB,EAAP;KALM;;IAQAE,yBAAA,GAAoB,UAAC0F,IAAD;UACpBC,YAAY,GAAS;QAAEnG,GAAG;OAAhC;UACMoG,GAAG,GAAG5F,OAAI,CAAC6F,aAAjB;UACMC,UAAU,GAAG9F,OAAI,CAAC+F,iBAAxB;UACMvB,GAAG,GAAGxE,OAAI,CAACiB,UAAjB;;UACI2E,GAAG,CAACI,IAAJ,CAASN,IAAT,CAAJ,EAAoB;;;;;;;;YAQZO,OAAO,GAAGP,IAAI,CAACQ,OAAL,CAAaN,GAAb,EAAkBE,UAAlB,CAAhB;YACMK,YAAY,GAAG,IAAIC,QAAJ,CAAa,MAAb,EAAqBH,OAArB,CAArB;QACAE,YAAY,CAACR,YAAD,CAAZ;OAVF,MAWO;;;;;;YAMCU,iBAAiB,GAAIC,MAAM,CAACnG,QAAlC;YACMoG,mBAAmB,GAAGD,MAAM,CAACnG,QAAP,CAAgBqG,aAA5C;YACMC,eAAe,GAAGtG,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAxB;YACMsG,cAAc,GAAGC,MAAM,CAACD,cAA9B;QACAD,eAAe,CAACG,GAAhB,GAAsBpC,GAAtB;QACAkC,cAAc,CAACL,iBAAD,EAAoB,eAApB,EAAqC;UACjDQ,KAAK,EAAEJ,eAD0C;UAEjDK,QAAQ,EAAE;SAFE,CAAd;YAIMX,YAAY,GAAG,IAAIC,QAAJ,CAAa,MAAb,EAAqBV,IAArB,CAArB;QACAS,YAAY,CAACR,YAAD,CAAZ;QACAe,cAAc,CAACL,iBAAD,EAAoB,eAApB,EAAqC;UACjDQ,KAAK,EAAEN,mBAD0C;UAEjDO,QAAQ,EAAE;SAFE,CAAd;QAIAL,eAAe,CAACM,MAAhB,IAA0BN,eAAe,CAACM,MAAhB,EAA1B;;AAEF,aAAOpB,YAAP;KAvCM;;IA0CA3F,6BAAA,GAAwB;UAC1BA,OAAI,CAACgH,QAAL,KAAkB,QAAtB,EAAgC;eACvB,IAAIrC,OAAJ,CAAY,UAAAC,GAAA;;;;;UAKhB5E,OAAI,CAACY,sBAAL,CAAyC,IAAzC;;UACAZ,OAAI,CAACc,oBAAL,CAAuC,gBAAvC,EAAyD,IAAzD;;UACAd,OAAI,CAACc,oBAAL,CAAuC,eAAvC,EAAwD,IAAxD;;UACAd,OAAI,CAACc,oBAAL,CAAuC,kBAAvC,EAA2D,IAA3D;;cACKmG,IAAI,GAAG,iBAAb;cACMC,QAAQ,GAAG/G,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAjB;UACA8G,QAAQ,CAACD,IAAT,GAAgBA,IAAhB;cACME,UAAU,GAAGb,MAAM,CAACd,IAA1B;UACA0B,QAAQ,CAACE,SAAT,GAAqB,2BAArB;UACAjH,QAAQ,CAACkH,IAAT,CAAc9G,WAAd,CAA0B2G,QAA1B;UACAZ,MAAM,CAACd,IAAP,CAAYhG,GAAZ,GAAkBA,GAAlB;cACM8H,QAAQ,GAAGnH,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAjB;UACAkH,QAAQ,CAACL,IAAT,GAAgBA,IAAhB;UACAK,QAAQ,CAACV,GAAT,GAAe5G,OAAI,CAACiB,UAApB;UACAd,QAAQ,CAACkH,IAAT,CAAc9G,WAAd,CAA0B+G,QAA1B;;UACAA,QAAQ,CAACC,MAAT,GAAkB;;;YACfvH,OAAI,CAACY,sBAAL,CAAyC,KAAzC;;YACAZ,OAAI,CAACc,oBAAL,CAAuC,gBAAvC,EAAyD,KAAzD;;YACAd,OAAI,CAACc,oBAAL,CAAuC,eAAvC,EAAwD,KAAxD;;YACAd,OAAI,CAACc,oBAAL,CAAuC,kBAAvC,EAA2D,KAA3D;;gBACK0G,WAAW,GAAQlB,MAAM,CAACd,IAAhC;YACCc,MAAc,CAACd,IAAf,GAAsB2B,UAAtB;gBACG,CAACnH,OAAI,CAAC8B,WAAV,EAAwB9B,OAAI,CAAC8B,WAAL,GAAmB9B,OAAI,CAACyH,cAAL,CAAoBD,WAApB,CAApB;gBACnB,CAACxH,OAAI,CAAC8B,WAAV,EAAuB,MAAMX,KAAK,CAAC,qCAAD,CAAX;YACvBnB,OAAI,CAAC6B,WAAL,CAAiBoB,EAAjB,GAAsBjD,OAAI,CAAC8B,WAA3B;YACA9B,OAAI,CAACkB,SAAL,GAAiBsG,WAAW,CAACxH,OAAI,CAAC8B,WAAN,CAA5B;kBACAoF,QAAQ,CAACQ,UAAT,UAAA,iBAAA,SAAA,MAAqB/E,YAAYuE,SAAjC;kBACAI,QAAQ,CAACI,UAAT,UAAA,iBAAA,SAAA,MAAqB/E,YAAY2E,SAAjC;YACA1C,GAAG,CAAC5E,OAAI,CAACkB,SAAN,CAAH;WAbF;SApBK,CAAP;OADF,MAqCO;eACE,IAAIyD,OAAJ,CAAY,UAAAC,GAAA;UACjB5E,OAAI,CAAC2H,aAAL,CAAmB3H,OAAI,CAACiB,UAAxB,EAAoC2G,IAApC,CAAyC,UAAAlD,IAAA;;;;gBAInC,CAACA,IAAD,IAAS,OAAOA,IAAP,KAAgB,QAA7B,EAAuC,MAAMvD,KAAK,CAAC,cAAD,CAAX;;YACtCnB,OAAI,CAACY,sBAAL,CAAyC,IAAzC;;YACAZ,OAAI,CAACc,oBAAL,CAAuC,gBAAvC,EAAyD,IAAzD;;YACAd,OAAI,CAACc,oBAAL,CAAuC,eAAvC,EAAwD,IAAxD;;YACAd,OAAI,CAACc,oBAAL,CAAuC,kBAAvC,EAA2D,IAA3D;;gBACK6E,YAAY,GAAG3F,OAAI,CAAC6H,iBAAL,CAAuBnD,IAAvB,CAArB;;YACC1E,OAAI,CAACY,sBAAL,CAAyC,KAAzC;;YACAZ,OAAI,CAACc,oBAAL,CAAuC,gBAAvC,EAAyD,IAAzD;;YACAd,OAAI,CAACc,oBAAL,CAAuC,eAAvC,EAAwD,IAAxD;;YACAd,OAAI,CAACc,oBAAL,CAAuC,kBAAvC,EAA2D,IAA3D;;gBACG,CAACd,OAAI,CAAC8B,WAAV,EAAwB9B,OAAI,CAAC8B,WAAL,GAAmB9B,OAAI,CAACyH,cAAL,CAAoB9B,YAApB,CAApB;gBACnB,CAAC3F,OAAI,CAAC8B,WAAV,EAAuB,MAAMX,KAAK,CAAC,qCAAD,CAAX;YACvBnB,OAAI,CAAC6B,WAAL,CAAiBoB,EAAjB,GAAsBjD,OAAI,CAAC8B,WAA3B;YACA9B,OAAI,CAACkB,SAAL,GAAiByE,YAAY,CAAC3F,OAAI,CAAC8B,WAAN,CAA7B;YACA8C,GAAG,CAAC5E,OAAI,CAACkB,SAAN,CAAH;WAlBF,EAmBG4G,KAnBH,CAmBS,UAAAC,GAAA;;;;YAIPC,OAAO,CAACC,IAAR,CAAa,wBAAb;;;;;YAIAjI,OAAI,CAACgH,QAAL,GAAgB,QAAhB;YACApC,GAAG,CAAC5E,OAAI,CAACwB,qBAAL,EAAD,CAAH;WA5BF;SADK,CAAP;;KAvCI;;IA0ERxB,cAAA,GAAS;aAAOC,mBAAA,MAAA;QAAKgD,EAAE,EAAEjD,OAAI,CAACF,KAAL,CAAWmD,EAAX,IAAiB;QAAIiF,GAAG,EAAElI,OAAI,CAACqB;OAAxC,CAAD;KAAf;;QA9WU2F,yBAAA;QAAUxC,eAAV;QAAetD,2BAAf;QAA0BH,iBAA1B;QAAgCmB,uBAAhC;QAAyCiG,yEAAzC;IACRnI,OAAI,CAACgH,QAAL,GAAgBA,QAAQ,IAAI,QAA5B;;IAEAhH,OAAI,CAACkC,OAAL,GAAe,OAAOA,OAAP,KAAmB,SAAnB,GAA+BA,OAA/B,GAAyC,IAAxD;;IAEAlC,OAAI,CAACkB,SAAL,GAAiBA,SAAjB;;IAEAlB,OAAI,CAACiB,UAAL,GAAkBuD,GAAG,IAAI,EAAzB;;IAEAxE,OAAI,CAACoI,aAAL,GAAqBD,gCAAgC,IAAI,kCAAzD;;IAEAnI,OAAI,CAAC6F,aAAL,GAAqB,IAAIwC,MAAJ,CAAWrI,OAAI,CAACoI,aAAhB,EAA+B,GAA/B,CAArB;;IAEApI,OAAI,CAAC8B,WAAL,GAAmBf,IAAI,IAAI,EAA3B;;IAEAf,OAAI,CAAC+F,iBAAL,GAA4B,CAC1B,IAAIsC,MAAJ,CAAW,4BAAX,EAAyC,GAAzC,EAA8CC,IAA9C,CAAmDtI,OAAI,CAACiB,UAAxD,KAAuE,CAAC,EAAD,CAD7C,EAE1B,CAF0B,OAA5B;;IAIAjB,OAAI,CAAC6B,WAAL,CAAiBoB,EAAjB,GAAsBjD,OAAI,CAAC8B,WAA3B;;;;IAIA9B,OAAI,CAACuI,QAAL;;;;;;;;;;;;;;;;;;;;;;;;;;kBAwVJ;EAhYuCtI,KAAK,CAACuI,cAA7C;;;;"}