{"version":3,"file":"index.js","sources":["../src/index.tsx"],"sourcesContent":["import React from 'react';\nimport Vue from 'vue';\nimport { mountRootParcel, ParcelConfig } from 'single-spa';\nimport singleSpaVue from 'single-spa-vue';\n\n\n// const rawHtmlAppendChild = HTMLHeadElement.prototype.appendChild;\n\n// const SCRIPT_TAG_NAME = 'SCRIPT';\n// const LINK_TAG_NAME = 'LINK';\n// const STYLE_TAG_NAME = 'STYLE';\n\n// HTMLHeadElement.prototype.appendChild = function appendChild<T extends Node>(this: any, newChild: T) {\n//   const element = newChild as any;\n//   console.log(8888, newChild)\n//   if (element.tagName) {\n//     switch (element.tagName) {\n//       case LINK_TAG_NAME:\n//       case STYLE_TAG_NAME: {\n//         const stylesheetElement: HTMLLinkElement | HTMLStyleElement = newChild as any;\n\n//         // // check if the currently specified application is active\n//         // // While we switch page from qiankun app to a normal react routing page, the normal one may load stylesheet dynamically while page rendering,\n//         // // but the url change listener must to wait until the current call stack is flushed.\n//         // // This scenario may cause we record the stylesheet from react routing page dynamic injection,\n//         // // and remove them after the url change triggered and qiankun app is unmouting\n//         // // see https://github.com/ReactTraining/history/blob/master/modules/createHashHistory.js#L222-L230\n//         // const activated = checkActivityFunctions(window.location).some(name => name === appName);\n//         // only hijack dynamic style injection when app activated\n//         // if (activated) {\n//         //   dynamicStyleSheetElements.push(stylesheetElement);\n//         // }\n\n//         break;\n//       }\n\n//       case SCRIPT_TAG_NAME: {\n//         const { src, text } = element as HTMLScriptElement;\n\n//         // if (src) {\n//         //   execScripts(null, [src], proxy).then(\n//         //     () => {\n//         //       // we need to invoke the onload event manually to notify the event listener that the script was completed\n//         //       // here are the two typical ways of dynamic script loading\n//         //       // 1. element.onload callback way, which webpack and loadjs used, see https://github.com/muicss/loadjs/blob/master/src/loadjs.js#L138\n//         //       // 2. addEventListener way, which toast-loader used, see https://github.com/pyrsmk/toast/blob/master/src/Toast.ts#L64\n//         //       const loadEvent = new CustomEvent('load');\n//         //       if (isFunction(element.onload)) {\n//         //         element.onload(loadEvent);\n//         //       } else {\n//         //         element.dispatchEvent(loadEvent);\n//         //       }\n//         //     },\n//         //     () => {\n//         //       const errorEvent = new CustomEvent('error');\n//         //       if (isFunction(element.onerror)) {\n//         //         element.onerror(errorEvent);\n//         //       } else {\n//         //         element.dispatchEvent(errorEvent);\n//         //       }\n//         //     },\n//         //   );\n\n//         //   const dynamicScriptCommentElement = document.createComment(`dynamic script ${src} replaced by qiankun`);\n//         //   return rawHtmlAppendChild.call(this, dynamicScriptCommentElement) as T;\n//         // }\n\n//         // execScripts(null, [`<script>${text}</script>`], proxy).then(element.onload, element.onerror);\n//         // const dynamicInlineScriptCommentElement = document.createComment('dynamic inline script replaced by qiankun');\n//         // return rawHtmlAppendChild.call(this, dynamicInlineScriptCommentElement) as T;\n//       }\n\n//       default:\n//         break;\n//     }\n//   }\n\n//   return rawHtmlAppendChild.call(this, element) as T;\n// };\n\n\n\n\n\n\n\nconst __VUE_INTERNAL_INIT__ = Vue.prototype._init;\nVue.prototype._init = function(options: any) {\n  /**\n   * TODO: 留个口儿 用来以后支持加载整个Vue应用\n   */\n  __VUE_INTERNAL_INIT__.call(this, options);\n};\n\ninterface Self {\n  Vue: typeof Vue;\n  [ propName: string ]: any;\n}\n\ninterface IProps0 {\n  name?: string;\n  id?: string;\n  visible?: boolean;\n  extraProps?: { [propName: string]: any };\n  loadType?: 'xhr' | 'script';\n  instable_publicPathBeReplacedKey?: string;\n}\n\ninterface IProps1 extends IProps0 {\n  url: string;\n  component?: object;\n}\n\ninterface IProps2 extends IProps0 {\n  component: object;\n  url?: string; \n}\n\ntype IProps = IProps1 | IProps2;\n\nexport default class VueIframe extends React.PureComponent<IProps, any> {\n  private loadType: IProps['loadType'];\n  private currentName: string; // 每个iframe的唯一标识\n  private visible: boolean; // 是否显示\n  private currentUrl: string; // 传进来的url\n  private currentPublicPath: string; // 传进来的url的协议+域名+端口\n  private publicPathKey: string; // 远程源代码中要被替换的关键字\n  private publicPathReg: RegExp; // 用来替换源代码中关键字的正则\n  private rootNodeWrapper = React.createRef<HTMLDivElement>(); // vue挂载节点是根据el再往上找它的爹\n  private component: any; // vue 组件实例\n  private parcel: any; // parcel实例\n  private vueWrapper1: HTMLDivElement = document.createElement('div'); // 挂载vue以及隐藏vue需要两个节点\n  private vueWrapper2: HTMLDivElement = document.createElement('div'); // 真正vue需要挂载的节点\n\n\n  constructor(props: IProps) {\n    super(props);\n    const { loadType, url, component, name, visible, instable_publicPathBeReplacedKey } = props;\n    this.loadType = loadType || 'script';\n    // 初始化时候是否显示\n    this.visible = typeof visible === 'boolean' ? visible : true;\n    // 获取到外部传进来的vue组件\n    this.component = component;\n    // 获取到外部传来的url\n    this.currentUrl = url || '';\n    // 这个属性是用来标识要替换远程源代码中的publicPath的关键字\n    this.publicPathKey = instable_publicPathBeReplacedKey || '__WILL_BE_REPLACED_PUBLIC_PATH__';\n    // 这个正则会用来把远程源码中的__webpack_require__.p = 'xxxxx' 的xxxxx这个publiPath给替换掉\n    this.publicPathReg = new RegExp(this.publicPathKey, 'g');\n    // 生成每个iframe的唯一表示\n    this.currentName = name || '';\n    // 获取传进来的url的协议+域名+端口\n    this.currentPublicPath = `${(\n      new RegExp(\"^https?://[\\\\w-.]+(:\\\\d+)?\", 'i').exec(this.currentUrl) || ['']\n    )[0]}/`;\n    // vue会挂载到这个节点2上\n    this.vueWrapper2.id = this.currentName;\n    // 节点1是为了可以让vue随时visibility 同时使vue的根节点脱离react的fiber树\n    this.vueWrapper1.appendChild(this.vueWrapper2);\n    // 临时保存appendChild\n    const originAppendChild = HTMLHeadElement.prototype.appendChild;\n    (this.internalCSSsandbox as Function) = this.internalCSSsandbox.bind(this, originAppendChild);\n  }\n\n  componentDidMount = async () => {\n    if (!this.currentUrl && !this.component) throw Error('组件必须接收一个url或者component属性');\n    const rootEleWrapper = this.rootNodeWrapper.current;\n    if (!rootEleWrapper) throw Error('没有vue组件的root节点');\n    // (this.internalCSSsandbox as any)(true);\n    const component = this.props.component || await this.getOriginVueComponent();\n    if (!this.isVueComponent(component)) return;\n    const lifecycles = this.registerVueComponent(this.vueWrapper2, component, this.currentName);\n    this.parcel = mountRootParcel((lifecycles as ParcelConfig), { domElement: '-' });\n    if (!this.visible) this.vueWrapper1.style.display = 'none';\n    rootEleWrapper.appendChild(this.vueWrapper1);\n    setTimeout(() => {\n      /**\n       * 对于一上来visible就是不可见的组件\n       * 先把display置为none 然后再添加进页面\n       * 这是为了防止vue组件中可能会有类似echarts\n       * 之类的工具会通过document.querySelector等\n       * 方法选择dom\n       * 如果直接就不把vue组件添加进页面的话\n       * vue组件内部那些选择dom的方法可能会产生问题\n       */\n      if (!this.visible) {\n        this.vueWrapper1 = rootEleWrapper?.removeChild(this.vueWrapper1) as HTMLDivElement;\n      }\n      this.vueWrapper1.style.display = 'block';\n    });\n    this.parcel.mountPromise.then(() => {\n      // debugger\n      // console.log('这里执行完了挂载')\n    });\n  }\n\n  componentDidUpdate = () => {\n    const { visible = true } = this.props; \n    if (visible === this.visible) return;\n    this.visible = visible;\n    const rootNodeWrapper = this.rootNodeWrapper.current;\n    if (!visible) {\n      this.vueWrapper1 = rootNodeWrapper?.removeChild(this.vueWrapper1) as HTMLDivElement;\n    } else {\n      rootNodeWrapper?.appendChild(this.vueWrapper1);\n    }\n  }\n\n  /**\n   * componentWillUnmount被调用时候不一定就是出错\n   * 但是贸然地在react项目中挂载vue组件可能出现问题\n   * 当出现问题的时候react组件会被卸载 此时会调用componentWillUnmount\n   * 这个时候应该确认下项目是否还正常运行(八成报错)\n   */\n  componentWillUnmount = () => {\n    (this.rootNodeWrapper.current as any).removeChild(this.vueWrapper1);\n    (this.vueWrapper1 as any) = null;\n    (this.vueWrapper2 as any) = null;\n    this.parcel.unmount();\n  }\n\n  private internalCSSsandbox = (\n    originAppendChild: <T extends Node>(this: any, newChild: T) => T,\n    codeIsExecuting: boolean,\n  ) => {\n    // if (!codeIsExecuting) HTMLHeadElement.prototype.appendChild = originAppendChild;\n    const SCRIPT_TAG_NAME = 'SCRIPT';\n    const LINK_TAG_NAME = 'LINK';\n    const STYLE_TAG_NAME = 'STYLE';\n\n    HTMLHeadElement.prototype.appendChild = function appendChild<T extends Node>(this: any, newChild: T) {\n      const element = newChild as any;\n      console.log(8888, newChild)\n      if (element.tagName) {\n        switch (element.tagName) {\n          case LINK_TAG_NAME:\n          case STYLE_TAG_NAME: {\n            const stylesheetElement: HTMLLinkElement | HTMLStyleElement = newChild as any;\n            break;\n          }\n          case SCRIPT_TAG_NAME: {\n            const { src, text } = element as HTMLScriptElement;\n          }\n          default:\n            break;\n        }\n      }\n      return originAppendChild.call(this, element) as T;\n    };\n\n  }\n\n  private registerVueComponent = (el: string | HTMLElement, vueComponent: object, id: string) => {\n    const vueInstance = singleSpaVue({\n      Vue,\n      appOptions: {\n        el: typeof el === 'string' ? `#${el}` : el,\n        render: (h: any) => h('div', { attrs: { id } }, [h(vueComponent, {\n          props: { ...this.props.extraProps },\n        })]),\n      },\n    });\n    return ({\n      bootstrap: vueInstance.bootstrap,\n      mount: vueInstance.mount,\n      unmount: vueInstance.unmount,\n    })\n  }\n\n  private isVueComponent = (component: any): boolean => {\n    return component && typeof component === 'object' && typeof component.render === 'function';\n  }\n\n  private getOriginCode = (url: string, method: string = 'GET', data?: any): Promise<any> => {\n    return new Promise((res, rej) => {\n      const xhr: XMLHttpRequest = XMLHttpRequest ? new XMLHttpRequest() :\n        ActiveXObject ? new ActiveXObject('Microsoft.XMLHTTP') : null;\n      if (method === 'GET' && data) data && (url += `?${data}`);\n      xhr.open(method, url, true);\n      if (method == 'GET') {\n        xhr.send();\n      } else {\n        xhr.setRequestHeader('content-type', 'text/plain');\n        xhr.send((data as (Document | BodyInit | null)));\n      }\n      xhr.onreadystatechange = () => {\n        if (xhr.readyState === 4) {\n          if (xhr.status === 200) res(xhr.responseText);\n          else rej(xhr);\n        }      \n      }\n    });\n  }\n\n  private getCurrentName = (self: any): string => {\n    for (const props in self) {\n      if (!self.hasOwnProperty(props)) break;\n      if (props !== 'Vue') return props;\n    }\n    return '';\n  }\n\n  private executeOriginCode = (code: string): Self => {\n    /**\n     * 求助: ts里用了bind之后会报参数不对的错, 不会写了......\n     */\n    // (this.internalCSSsandbox as Function)(true);\n    const internalSelf: Self = { Vue };\n    const reg = this.publicPathReg;\n    const publicPath = this.currentPublicPath;\n    const url = this.currentUrl;\n    if (reg.test(code)) {\n      /**\n       * 自己开发组件的时候使用可以配置publicPath\n       * 为了让react-vue-mirco-frame支持加载静态资源\n       * 可以给publicPath设置为一个约定好的值\n       * 然后这里用传进来的origin替换掉这个约定好的值\n       * 这个约定好的值默认是 __WILL_BE_REPLACED_PUBLIC_PATH__\n       */\n      const codeStr = code.replace(reg, publicPath);\n      const originCodeFn = new Function(\"self\", codeStr);\n      originCodeFn(internalSelf);\n    } else {\n      /**\n       * 如果没有配置这个值的话 就以hack的方式注入origin\n       * webpack打包出来的umd代码里面会动态监测document.currentScript\n       * 通过临时给这个currentScript换掉的方式让webpack将origin注入进代码\n       */\n      const temporaryDocument = (window.document as any);\n      const originCurrentScript = window.document.currentScript;\n      const temporaryScript = document.createElement('script');\n      const defineProperty = Object.defineProperty;\n      temporaryScript.src = url;\n      defineProperty(temporaryDocument, 'currentScript', {\n        value: temporaryScript,\n        writable: true,\n      });\n      const originCodeFn = new Function(\"self\", code);\n      originCodeFn(internalSelf);\n      defineProperty(temporaryDocument, 'currentScript', {\n        value: originCurrentScript,\n        writable: false,\n      });\n      temporaryScript.remove && temporaryScript.remove();\n    };\n    // (this.internalCSSsandbox as Function)(false);\n    return internalSelf;\n  } \n\n  private getOriginVueComponent = (): object => {\n    if (this.loadType === 'script') {\n      (this.internalCSSsandbox as any)(true);\n      return new Promise(res => {\n        const type = 'text/javascript';\n        const oScript1 = document.createElement('script');\n        oScript1.type = type;\n        const originSelf = window.self;\n        oScript1.innerText = 'window.self = {Vue: null}';\n        document.body.appendChild(oScript1);\n        window.self.Vue = Vue;\n        const oScript2 = document.createElement('script');\n        oScript2.type = type;\n        oScript2.src = this.currentUrl;\n        document.body.appendChild(oScript2);\n        oScript2.onload = () => {\n          const currentSelf: any = window.self;\n          (window as any).self = originSelf;\n          if (!this.currentName) (this.currentName = this.getCurrentName(currentSelf));\n          if (!this.currentName) throw Error('没有获取到vue组件, 造成问题的原因可能是远程组件并未遵循umd规范');\n          this.vueWrapper2.id = this.currentName;\n          this.component = currentSelf[this.currentName];\n          oScript1.parentNode?.removeChild(oScript1);\n          oScript2.parentNode?.removeChild(oScript2);\n          res(this.component);\n        };\n      });\n    } else {\n      return new Promise(res => {\n        this.getOriginCode(this.currentUrl).then(data => {\n          /**\n           * 通过XMLHttpRequest获取源代码\n           */\n          if (!data || typeof data !== 'string') throw Error('没有加载到远程vue组件');\n          const internalSelf = this.executeOriginCode(data);\n          if (!this.currentName) (this.currentName = this.getCurrentName(internalSelf));\n          if (!this.currentName) throw Error('没有获取到vue组件, 造成问题的原因可能是远程组件并未遵循umd规范');\n          this.vueWrapper2.id = this.currentName;\n          this.component = internalSelf[this.currentName];\n          res(this.component);\n        }).catch(err => {\n          /**\n           * 如果进入到这里说明可能请求出错了\n           */\n          console.warn('远程vue组件请求可能出现跨域或其他网络问题');\n          /**\n           * 如果出现跨域问题就强制使用script方式加载一遍\n           */\n          this.loadType = 'script';\n          res(this.getOriginVueComponent());\n        })\n      })\n    } \n  }\n\n  render = () => (<div id={this.props.id || ''} ref={this.rootNodeWrapper} />)\n}\n"],"names":["__VUE_INTERNAL_INIT__","Vue","prototype","_init","options","call","__extends","props","_super","_this","React","createRef","document","createElement","currentUrl","component","Error","rootEleWrapper","rootNodeWrapper","current","_a","getOriginVueComponent","_b","isVueComponent","lifecycles","registerVueComponent","vueWrapper2","currentName","parcel","mountRootParcel","domElement","visible","vueWrapper1","style","display","appendChild","setTimeout","removeChild","mountPromise","then","_c","unmount","originAppendChild","codeIsExecuting","SCRIPT_TAG_NAME","LINK_TAG_NAME","STYLE_TAG_NAME","HTMLHeadElement","newChild","element","console","log","tagName","src","text","el","vueComponent","id","vueInstance","singleSpaVue","appOptions","render","h","attrs","extraProps","bootstrap","mount","url","method","data","Promise","res","rej","xhr","XMLHttpRequest","ActiveXObject","open","send","setRequestHeader","onreadystatechange","readyState","status","responseText","self","hasOwnProperty","code","internalSelf","reg","publicPathReg","publicPath","currentPublicPath","test","codeStr","replace","originCodeFn","Function","temporaryDocument","window","originCurrentScript","currentScript","temporaryScript","defineProperty","Object","value","writable","remove","loadType","internalCSSsandbox","type","oScript1","originSelf","innerText","body","oScript2","onload","currentSelf","getCurrentName","parentNode","getOriginCode","executeOriginCode","catch","err","warn","ref","name","instable_publicPathBeReplacedKey","publicPathKey","RegExp","exec","bind","PureComponent"],"mappings":"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"}